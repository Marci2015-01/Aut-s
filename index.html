<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Forza Horizon 5 - Ultra Realism</title>
    <style>
        * { -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; outline: none; }
        body, html { margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden; background: #000; position: fixed; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; filter: saturate(1.2) contrast(1.1); }

        /* FH5 HUD */
        #hud {
            position: absolute; bottom: 30px; right: 30px;
            width: 140px; height: 140px; border-radius: 50%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
            border: 4px solid #ff0055; display: flex; flex-direction: column;
            align-items: center; justify-content: center; color: white;
            box-shadow: 0 0 30px rgba(255, 0, 85, 0.4); pointer-events: none;
        }
        #kmh { font-size: 45px; font-weight: 900; font-style: italic; color: #fff; }

        /* Mobil érintési zónák (Láthatatlan, de működik) */
        .touch-zone { position: absolute; top: 0; height: 100%; width: 50%; z-index: 10; touch-action: none; }
        #left-zone { left: 0; }
        #right-zone { right: 0; }
    </style>
</head>
<body>

    <div id="left-zone" class="touch-zone"></div>
    <div id="right-zone" class="touch-zone"></div>

    <div id="hud">
        <div id="kmh">0</div>
        <div style="font-size: 10px; font-weight: bold; color: #00f2ff; letter-spacing: 2px;">KM/H</div>
    </div>

    <canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let w, h, px = 14.5, py = 14.5, pa = 0, speed = 0, steer = 0, visualSteer = 0, noseDive = 0;
const mapSize = 64;
const world = new Uint8Array(mapSize * mapSize);
const houseColors = ["#e74c3c", "#f1c40f", "#1abc9c", "#e67e22", "#ecf0f1"];
const worldColors = new Uint8Array(mapSize * mapSize);

for(let i=0; i<mapSize*mapSize; i++) {
    let tx = i % mapSize, ty = Math.floor(i / mapSize);
    if (tx % 14 === 0 || ty % 14 === 0) world[i] = 0;
    else if (Math.random() > 0.4) { world[i] = 1; worldColors[i] = Math.floor(Math.random() * 5); }
    if(tx == 0 || tx == mapSize-1 || ty == 0 || ty == mapSize-1) world[i] = 1;
}

const input = { gas: 0, brake: 0, left: 0, right: 0 };

// PC Irányítás
window.onkeydown = e => {
    if(e.key == "w") input.gas = 1; if(e.key == "s") input.brake = 1;
    if(e.key == "a") input.left = 1; if(e.key == "d") input.right = 1;
};
window.onkeyup = e => {
    if(e.key == "w") input.gas = 0; if(e.key == "s") input.brake = 0;
    if(e.key == "a") input.left = 0; if(e.key == "d") input.right = 0;
};

// Mobil Irányítás (Zónák: Bal oldal kormány, Jobb oldal gáz)
document.getElementById('left-zone').ontouchstart = (e) => {
    let touchX = e.touches[0].clientX;
    if(touchX < window.innerWidth / 4) input.left = 1; else input.right = 1;
};
document.getElementById('left-zone').ontouchend = () => { input.left = 0; input.right = 0; };

document.getElementById('right-zone').ontouchstart = (e) => {
    let touchY = e.touches[0].clientY;
    if(touchY < window.innerHeight / 2) input.gas = 1; else input.brake = 1;
};
document.getElementById('right-zone').ontouchend = () => { input.gas = 0; input.brake = 0; };

function update() {
    // Élethű gyorsulás és fék
    if (input.gas) speed += 0.006;
    if (input.brake) {
        if (speed > 0.01) { speed -= 0.012; noseDive += (20 - noseDive) * 0.15; }
        else { speed -= 0.005; noseDive += (-10 - noseDive) * 0.1; }
    } else { noseDive *= 0.85; }

    speed *= 0.985; // Súrlódás

    // Kormányzás tehetetlenséggel
    let targetSteer = (input.right - input.left) * 0.05;
    steer += (targetSteer - steer) * 0.15;
    visualSteer += (steer * 20 - visualSteer) * 0.1;
    
    if (Math.abs(speed) > 0.005) {
        pa += steer * (Math.abs(speed) * 5) * (speed < 0 ? -1 : 1);
    }

    let nx = px + Math.cos(pa) * speed, ny = py + Math.sin(pa) * speed;
    if (world[Math.floor(ny) * mapSize + Math.floor(nx)] === 0) { px = nx; py = ny; }
    else { speed = -speed * 0.5; }
}

function draw() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
    update();

    const fov = 1.0 + (Math.abs(speed) * 2); // Dinamikus FOV
    const step = w < 800 ? 6 : 2; 

    for(let x = 0; x < w; x += step) {
        let rayA = (pa - fov/2) + (x/w) * fov;
        let dist = 0, wallIdx = -1, vx = Math.cos(rayA), vy = Math.sin(rayA);
        while(dist < 18) {
            dist += 0.1;
            let tx = px + vx * dist, ty = py + vy * dist;
            if(world[Math.floor(ty) * mapSize + Math.floor(tx)] === 1) { 
                wallIdx = Math.floor(ty) * mapSize + Math.floor(tx); break; 
            }
        }
        let wallH = h / (dist * Math.cos(rayA - pa));
        
        // Égbolt és Aszfalt (Gradiens hatás)
        ctx.fillStyle = "#87CEEB"; ctx.fillRect(x, 0, step, h/2 + noseDive);
        ctx.fillStyle = "#333"; ctx.fillRect(x, h/2 + noseDive, step, h/2 - noseDive);

        if(wallIdx >= 0) {
            let s = 255 - (dist * 12);
            ctx.fillStyle = houseColors[worldColors[wallIdx]];
            ctx.globalAlpha = Math.max(0, 1 - dist/18);
            ctx.fillRect(x, h/2 - wallH/2 + noseDive, step, wallH);
            ctx.fillStyle = `rgba(0,0,0,0.1)`; // Finom árnyék
            ctx.fillRect(x, h/2 - wallH/2 + noseDive, step, wallH);
            ctx.globalAlpha = 1;
        }
    }

    // --- KORMÁNYKERÉK (Dinamikusan forog) ---
    ctx.save();
    ctx.translate(w/2 + visualSteer * 5, h - 100 + noseDive);
    ctx.rotate(visualSteer);
    
    // Kormány külső gyűrűje
    ctx.strokeStyle = "#111"; ctx.lineWidth = 25;
    ctx.beginPath(); ctx.arc(0, 0, 150, 0, Math.PI * 2); ctx.stroke();
    
    // Kormány küllői
    ctx.fillStyle = "#222";
    ctx.fillRect(-150, -10, 300, 20);
    ctx.fillRect(-10, 0, 20, 150);
    
    // Közép (Logo helye)
    ctx.fillStyle = "#000";
    ctx.beginPath(); ctx.arc(0, 0, 40, 0, 7); ctx.fill();
    ctx.restore();

    // Műszerfal alja
    ctx.fillStyle = "#050505";
    ctx.fillRect(0, h-50, w, 50);

    document.getElementById("kmh").innerText = Math.floor(Math.abs(speed) * 450);
    requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
